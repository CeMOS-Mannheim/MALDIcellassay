<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MALDI cell based assay Example • MALDIcellassay</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MALDI cell based assay Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MALDIcellassay</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.47.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Example.html">MALDI cell based assay Example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CeMOS-Mannheim/MALDIcellassay/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MALDI cell based assay Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CeMOS-Mannheim/MALDIcellassay/blob/main/vignettes/Example.Rmd" class="external-link"><code>vignettes/Example.Rmd</code></a></small>
      <div class="d-none name"><code>Example.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>In this document we will apply an automated screening for possible
candidate signals that show a response to treatment with a compound. For
details how to do the experimental part check out our Nature Protocols
publication Unger 2021 “Label-free Cell Assays of Compound Uptake and
Drug Action using MALDI-TOF Mass Spectrometry”. Briefly, cells were
treated with the following concentration of a compound: 0, 0.04, 0.12,
0.37, 1.11, 3.33, 10, 30 uM. After incubation the cells were washed,
transferred to a MALDI target plate and matrix was applied. For each
concentration 4 spots were applied which means that we also have 4
“measurement replicates” for each concentration.</p>
<p>The most important function in this package is fitCurve(). It does
not only fit the dose response curve and compute score values but it
also does most of the necessary steps needed to prepare the data for
fitting like normalization and alignment. In this tutorial we want to
first look at each of this steps individually and then apply the
fitCurve() function the helps us combine all of them.</p>
<p>For the sake to keep this package small, the spectra used as an
example here were trimmed to 400-900 Da mass-range and stored in a
compact form as example data.</p>
</div>
<div class="section level3">
<h3 id="example-data-and-quality-check">Example data and quality check<a class="anchor" aria-label="anchor" href="#example-data-and-quality-check"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CeMOS-Mannheim/MALDIcellassay" class="external-link">MALDIcellassay</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strimmerlab.github.io/software/maldiquant/" class="external-link">MALDIquant</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This is MALDIquant version 1.22.3</span></span>
<span><span class="co">#&gt; Quantitative Analysis of Mass Spectrometry Data</span></span>
<span><span class="co">#&gt;  See '?MALDIquant' for more information about this package.</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Blank2022spec"</span><span class="op">)</span></span></code></pre></div>
<p>First we will check the spectra for general quality.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">Blank2022spec</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"0uM, replicate 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/qualityCheck-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h3>
<p>The baseline of the spectra already looks ok but for the sake of this
tutorial we will apply a baseline correction. But first we want so save
the names of the spectra (which are the concentrations used to treat the
cells). Also to get a better overview of the data we compute the mean
spectra of each concentration (there are 4 measurement replicates for
each concentration) and plot them around m/z 760 as we want to use this
signal to normalize and also as lock mass.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Blank2022spec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec_prc</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/removeBaseline-methods.html" class="external-link">removeBaseline</a></span><span class="op">(</span><span class="va">Blank2022spec</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spec_prc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">conc</span></span>
<span></span>
<span><span class="va">avg</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/averageMassSpectra-functions.html" class="external-link">averageMassSpectra</a></span><span class="op">(</span><span class="va">spec_prc</span>, labels <span class="op">=</span> <span class="va">conc</span><span class="op">)</span></span>
<span><span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">avg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Overview of mean spectra"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">755</span>, <span class="fl">765</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu">lines</span><span class="op">(</span><span class="va">avg</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span>, <span class="st">"uM"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/baseline-1.png" width="768">
We see that the alignment of the spectra is quite good but the intensity
varies for the peak around m/z 760. To get best results its necessary to
normalize the spectra to each other. One way is to add a standard to
each measurement spot (internal standard). This is not always possible
and another option is to use endogenous peaks with high abundance like
the signal around 760 m/z. As an example we will now find out the m/z
deviation to this signal for each spectrum. First we need to detect the
peaks, then we convert the peaks to a data.frame and finally we use
getMzShift() to find the mass shift in each spectrum.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/detectPeaks-methods.html" class="external-link">detectPeaks</a></span><span class="op">(</span><span class="va">Blank2022spec</span>, method <span class="op">=</span> <span class="st">"SuperSmoother"</span>, SNR <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Blank2022spec</span><span class="op">)</span></span>
<span><span class="va">mz_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMzShift.html">getMzShift</a></span><span class="op">(</span>peaks <span class="op">=</span> <span class="va">peaks</span>, targetMz <span class="op">=</span> <span class="fl">760.585</span>, tol <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; found mz 760.585 in 32 / 32 spectra</span></span>
<span><span class="co">#&gt; 11:06 mzshift was -0.0796625 in mean and 0.0828  abs. max.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mz_shift</span><span class="op">$</span><span class="va">mzshift</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#&gt; -0.08280 -0.08280 -0.08280 -0.07966 -0.08280 -0.05770</span></span></code></pre></div>
<p>As we already suspected the shift is quite small. Now lets use it to
align the spectra</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_align</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shiftMassAxis.html">shiftMassAxis</a></span><span class="op">(</span><span class="va">Blank2022spec</span>, <span class="va">mz_shift</span><span class="op">$</span><span class="va">mzshift</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have aligned spectra the next step is to normalize them.
Also here, a internal standard would be great but as we dont have one we
again use the m/z 760 endogenous signal. First we extract the
intensities for each spectrum of this signal and then we use it as a
normalization factor.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peaks_align</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/detectPeaks-methods.html" class="external-link">detectPeaks</a></span><span class="op">(</span><span class="va">spec_align</span>, method <span class="op">=</span> <span class="st">"SuperSmoother"</span>, SNR <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getNormFactors.html">getNormFactors</a></span><span class="op">(</span>peaksdf <span class="op">=</span> <span class="fu"><a href="../reference/peaks2df.html">peaks2df</a></span><span class="op">(</span><span class="va">peaks_align</span><span class="op">)</span>, targetMz <span class="op">=</span> <span class="fl">760.585</span>, tol <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">norm</span><span class="op">$</span><span class="va">norm_factor</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;    7949   12842   14492   14099   16145   19570</span></span>
<span><span class="va">spec_rdy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalizeByFactor.html">normalizeByFactor</a></span><span class="op">(</span><span class="va">spec_align</span>, <span class="va">norm</span><span class="op">$</span><span class="va">norm_factor</span><span class="op">)</span></span></code></pre></div>
<p>As a final check we now plot again the aligned and normalizes mean
spectra for each concentration.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avg_rdy</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/averageMassSpectra-functions.html" class="external-link">averageMassSpectra</a></span><span class="op">(</span><span class="va">spec_rdy</span>, labels <span class="op">=</span> <span class="va">conc</span><span class="op">)</span></span>
<span><span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">avg_rdy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Overview of mean spectra"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">755</span>, <span class="fl">765</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">avg_rdy</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu">lines</span><span class="op">(</span><span class="va">avg_rdy</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">avg</span><span class="op">)</span>, <span class="st">"uM"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, lty<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/finalCheck-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="high-variance-filtering">High variance filtering<a class="anchor" aria-label="anchor" href="#high-variance-filtering"></a>
</h3>
<p>As expected we find our spectra to be perfectly aligned and
normalized to 760.585. Now we can again detect peaks, bin them and
compose a intensity matrix of all peaks.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peaks_rdy</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/detectPeaks-methods.html" class="external-link">detectPeaks</a></span><span class="op">(</span><span class="va">avg_rdy</span>, method <span class="op">=</span> <span class="st">"SuperSmoother"</span>, SNR <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">peaks_rdy</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/binPeaks-functions.html" class="external-link">binPeaks</a></span><span class="op">(</span><span class="va">peaks_rdy</span><span class="op">)</span></span>
<span><span class="va">intmat</span> <span class="op">&lt;-</span> <span class="fu">MALDIquant</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MALDIquant/man/intensityMatrix-functions.html" class="external-link">intensityMatrix</a></span><span class="op">(</span><span class="va">peaks_rdy</span>, <span class="va">avg_rdy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">intmat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   8 211</span></span></code></pre></div>
<p>We get a intensity matrix with 211 peaks in total. The next step is
to screen for high variant peaks.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">intmat</span>, <span class="fl">2</span>, <span class="va">var</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vars</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">highVarIntmat</span> <span class="op">&lt;-</span> <span class="va">intmat</span><span class="op">[</span>,<span class="va">idx</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">highVarIntmat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  8 20</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-curve">Fit Curve<a class="anchor" aria-label="anchor" href="#fit-curve"></a>
</h3>
<p>We end up with 20 candidate peaks for which we want to fit a IC50
curve. Lets do the fitting for one exemplary signal.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concLog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">concLog</span> <span class="op">==</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">concLog</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">concLog</span> <span class="op">==</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">concLog</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">concLog</span> <span class="op">==</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu">nplr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nplr/man/convertToProp.html" class="external-link">convertToProp</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">intmat</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">nplr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nplr/man/nplr.html" class="external-link">nplr</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">concLog</span>, y <span class="op">=</span> <span class="va">resp</span>, useLog <span class="op">=</span> <span class="cn">FALSE</span>, npars <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"m/z ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">intmat</span><span class="op">)</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span>, main <span class="op">=</span> <span class="va">title</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/fit-1.png" width="768">
And with that we are finished! As said during the introduction we did
each step manually.</p>
</div>
<div class="section level2">
<h2 id="maldicellassay-workflow">MALDIcellassay Workflow<a class="anchor" aria-label="anchor" href="#maldicellassay-workflow"></a>
</h2>
<p>To do what we did in an automated way for each signal of interest use
the following function.</p>
<p>Note, that we use the pre-processed spectra (baseline removed).
Baseline removal and smoothing can (if needed) be performed with
<code>MALDIquant</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitCurve.html">fitCurve</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="va">spec_prc</span>,</span>
<span>         SinglePointRecal <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         normMeth <span class="op">=</span> <span class="st">"mz"</span>,</span>
<span>         varFilterMethod <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>         normMz <span class="op">=</span> <span class="fl">760.585</span>, </span>
<span>         alignTol <span class="op">=</span> <span class="fl">0</span>, </span>
<span>         normTol <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>         verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in value[[3L]](cond): m/z 760.585 failed. Re-trying with npar='all' and additional noise (mean=0, sd=1e-4).</span></span>
<span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; ------MALDIassay object------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Including 8 concentrations,</span></span>
<span><span class="co">#&gt; ranging from 0 to 30 .</span></span>
<span><span class="co">#&gt; Normalization on m/z 760.58 ± 0.1 Da.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Single point recalibation on 760.58 with 0.1 Da tolerance.</span></span>
<span><span class="co">#&gt; Avg. mass shift before recal.: -0.0797 Da. Max abs. shift: 0.0828 Da.</span></span>
<span><span class="co">#&gt; Avg. mass shift after recal. : 0 Da. Max abs. shift: 0 Da.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Found 249 peaks (SNR 3) and 249 high variance peaks</span></span>
<span><span class="co">#&gt; using variance filtering method: none.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Top5-features based on Fold-Change and R²:</span></span>
<span><span class="co">#&gt;        mz mzIdx pEC50   R2 log2FC SSMD   V'   Z'  CRS</span></span>
<span><span class="co">#&gt; 1 620.383   111 -0.31 0.97   3.23 5.56 0.82 0.37 85.4</span></span>
<span><span class="co">#&gt; 2 662.422   134 -0.62 0.99   3.00 4.11 0.91 0.13 72.0</span></span>
<span><span class="co">#&gt; 3 634.398   120 -0.48 0.99   2.61 4.15 0.89 0.13 71.7</span></span>
<span><span class="co">#&gt; 4 810.604   208 -0.62 1.00   1.79 5.03 0.92 0.27 71.4</span></span>
<span><span class="co">#&gt; 5 811.602   209 -0.64 0.99   1.90 4.68 0.90 0.22 68.8</span></span></code></pre></div>
<div class="section level3">
<h3 id="screen-the-results-for-interesting-signals">Screen the results for interesting signals<a class="anchor" aria-label="anchor" href="#screen-the-results-for-interesting-signals"></a>
</h3>
<p>We can also extract a data.frame with all the peaks and quality
metrics. We actually got a sneak peak on the results above from the
<code>show</code> method of the <code>MALDIassay</code>-class. From
there we can see that <code>mzIdx</code> 111 (<strong>m/z</strong>
620.4) scored the highest CRS score with around 85%.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPeakStatistics.html">getPeakStatistics</a></span><span class="op">(</span><span class="va">res</span>, summarise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p>Depending on our experimental setup (targeted i.e. we know our
<strong>m/z</strong> of interest or un-targeted) we might also want to
look at V’, Z’ and log2FC individually.</p>
<p>When we take a look at our highest hit we observe a good fit of the
curve (V’), high distance between the lower and the upper part of the
curve (log2FC) combined with low variance (Z’). Still we dont have a
sigmoidal shape so either we did not use the right concentration range
or we need to look deeper into the data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPeak.html">plotPeak</a></span><span class="op">(</span><span class="va">res</span>, mzIdx <span class="op">=</span> <span class="fl">111</span>, tol <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/plotTopHit-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCurves.html">plotCurves</a></span><span class="op">(</span><span class="va">res</span>, mzIdx <span class="op">=</span> <span class="fl">111</span>, errorbars <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/plotTopHit-2.png" width="768">
Here we might have a slightly better curve at a lower CRS. The CRS is
intended to quickly filter out signals that make no sense at all but in
makes sense to visually check the top hits.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPeak.html">plotPeak</a></span><span class="op">(</span><span class="va">res</span>, mzIdx <span class="op">=</span> <span class="fl">193</span>, tol <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/plotBetterHit-1.png" width="768"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCurves.html">plotCurves</a></span><span class="op">(</span><span class="va">res</span>, mzIdx <span class="op">=</span> <span class="fl">193</span>, errorbars <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Example_files/figure-html/plotBetterHit-2.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] MALDIquant_1.22.3          MALDIcellassay_0.4.47.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] sass_0.4.9               utf8_1.2.4               generics_0.1.3          </span></span>
<span><span class="co">#&gt;  [4] tidyr_1.3.1              nplr_0.1-7               digest_0.6.37           </span></span>
<span><span class="co">#&gt;  [7] magrittr_2.0.3           evaluate_0.24.0          grid_4.4.1              </span></span>
<span><span class="co">#&gt; [10] fastmap_1.2.0            jsonlite_1.8.8           purrr_1.0.2             </span></span>
<span><span class="co">#&gt; [13] fansi_1.0.6              viridisLite_0.4.2        scales_1.3.0            </span></span>
<span><span class="co">#&gt; [16] XML_3.99-0.17            textshaping_0.4.0        jquerylib_0.1.4         </span></span>
<span><span class="co">#&gt; [19] cli_3.6.3                rlang_1.1.4              MALDIquantForeign_0.14.1</span></span>
<span><span class="co">#&gt; [22] munsell_0.5.1            withr_3.0.1              base64enc_0.1-3         </span></span>
<span><span class="co">#&gt; [25] cachem_1.1.0             yaml_2.3.10              tools_4.4.1             </span></span>
<span><span class="co">#&gt; [28] parallel_4.4.1           dplyr_1.1.4              colorspace_2.1-1        </span></span>
<span><span class="co">#&gt; [31] ggplot2_3.5.1            forcats_1.0.0            vctrs_0.6.5             </span></span>
<span><span class="co">#&gt; [34] readBrukerFlexData_1.9.2 R6_2.5.1                 lifecycle_1.0.4         </span></span>
<span><span class="co">#&gt; [37] fs_1.6.4                 ragg_1.3.2               pkgconfig_2.0.3         </span></span>
<span><span class="co">#&gt; [40] desc_1.4.3               readMzXmlData_2.8.3      pkgdown_2.1.0           </span></span>
<span><span class="co">#&gt; [43] pillar_1.9.0             bslib_0.8.0              gtable_0.3.5            </span></span>
<span><span class="co">#&gt; [46] glue_1.7.0               systemfonts_1.1.0        highr_0.11              </span></span>
<span><span class="co">#&gt; [49] xfun_0.47                tibble_3.2.1             tidyselect_1.2.1        </span></span>
<span><span class="co">#&gt; [52] knitr_1.48               farver_2.1.2             htmltools_0.5.8.1       </span></span>
<span><span class="co">#&gt; [55] labeling_0.4.3           rmarkdown_2.28           svMisc_1.2.3            </span></span>
<span><span class="co">#&gt; [58] compiler_4.4.1</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Enzlein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
